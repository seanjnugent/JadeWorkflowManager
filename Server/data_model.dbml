// Users Table
Table user {
  id integer [primary key]
  username varchar
  email varchar [unique]
  password_hash varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
  role varchar [note: "e.g., admin, user, viewer"]
}

// Workflow Permissions Table
Table workflow_permission {
  id integer [primary key]
  user_id integer [ref: > user.id]
  workflow_id integer [ref: > workflow.id]
  permission_level varchar [note: "e.g., read, write, execute"]
  created_at timestamp [default: `now()`]
}

// Workflow Table
Table workflow {
  id integer [primary key]
  name varchar
  description text
  created_by integer [ref: > user.id]
  created_at timestamp [default: `now()`]
  updated_at timestamp
  status varchar [note: "e.g., draft, active, archived"]
  schedule varchar [note: "e.g., cron expression for scheduling"]
  last_run_at timestamp
  next_run_at timestamp
}

// Workflow Step Table
Table workflow_step {
  id integer [primary key]
  workflow_id integer [ref: > workflow.id]
  step_order integer [note: "Order of execution"]
  label varchar
  description text
  code_type varchar [note: "e.g., Python, SQL, R"]
  code text [note: "Actual code for transformation"]
  input_file_pattern varchar [note: "e.g., *.csv, data_*.xlsx"]
  output_file_pattern varchar [note: "e.g., output_*.csv"]
  parameters json [note: "Key-value pairs for dynamic inputs"]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// Run Table
Table run {
  id integer [primary key]
  workflow_id integer [ref: > workflow.id]
  triggered_by integer [ref: > user.id]
  status varchar [note: "e.g., running, completed, failed"]
  started_at timestamp [default: `now()`]
  finished_at timestamp
  input_file_path varchar [note: "Path to input file"]
  output_file_path varchar [note: "Path to output file"]
  error_message text [note: "Error details if run failed"]
}

// Run Log Table
Table run_log {
  id integer [primary key]
  run_id integer [ref: > run.id]
  step_id integer [ref: > workflow_step.id]
  log_level varchar [note: "e.g., info, warning, error"]
  message text
  timestamp timestamp [default: `now()`]
}

// Connections Table (for destinations)
Table connection {
  id integer [primary key]
  name varchar
  type varchar [note: "e.g., PostgreSQL, MySQL, BigQuery, CSV"]
  host varchar
  port integer
  database_name varchar
  username varchar
  password_hash varchar
  created_by integer [ref: > user.id]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// Workflow Destination Table
Table workflow_destination {
  id integer [primary key]
  workflow_id integer [ref: > workflow.id]
  connection_id integer [ref: > connection.id]
  destination_type varchar [note: "e.g., table, file"]
  table_name varchar [note: "For database destinations"]
  file_path varchar [note: "For file destinations"]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}
